{% extends 'base.html.twig' %}

{% block title %}New Task{% endblock %}

{% block body %}
    <h1>Create new Task</h1>

    {{ include('task/_form.html.twig') }}

    <a href="{{ path('app_task_index') }}">← Volver al listado</a>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const wrapper = document.getElementById('subtasks-wrapper');
            const addButton = document.getElementById('add-subtask');
            let index = wrapper.querySelectorAll('.subtask-form').length;

            if (!wrapper) {
                console.error('No se encontró el contenedor #subtasks-wrapper');
                return;
            }
            if (!addButton) {
                console.error('No se encontró el botón #add-subtask');
                return;
            }

            addButton.addEventListener('click', () => {
                console.log('Click detectado en Añadir subtarea');
                const prototype = wrapper.dataset.prototype;

                if (!prototype) {
                    console.error('El data-prototype está vacío');
                    return;
                }

                const newForm = prototype.replace(/__name__/g, index);
                const div = document.createElement('div');
                div.classList.add('subtask-form');
                div.innerHTML = newForm;
                wrapper.appendChild(div);
                index++;

                console.log('Subtarea añadida, nuevo índice:', index);
            });
        });
    </script>
{% endblock %}

